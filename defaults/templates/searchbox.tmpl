{{define "searchbox.tmpl"}}
<div class="search-box">
<form class="search-form" method="get" action="/api">
{{/* Define some useful local variables for form.*/}}
{{- $qryTerms := (dotpath ".request.query.query" . "") -}}
{{- $highlight := (has_dotpath ".request.highlight.style" . "true" "false") -}} 
{{- $from := (int .request.from) -}}
{{- $size := (int .request.size) -}}
{{- $total := (int .total_hits) -}}
{{- $prev := (previ $from $size 0 $total false) -}}
{{- $next := (nexti $from $size 0 $total false) -}}
{{- $fields := (join (dotpath ".request.fields" . nil) ",") -}}
{{- $fieldValues := (dotpath ".request.fields" . nil) -}}
{{- $sortBy := (join (dotpath ".request.sort" . nil) ",") -}}
<!-- 
DEBUG: START
    + Query: {{$qryTerms}} {{typeof $qryTerms}}
    + From: {{$from}} {{typeof $from}}
    + Size: {{$size}} {{typeof $size}}
    + Next: {{$next}} {{typeof $next}}
    + Prev: {{$prev}} {{typeof $prev}}
    + Total: {{$total}} {{typeof $total}}
    + Sort By: {{$sortBy}} {{typeof $sortBy}}
    + Fields: {{$fields}} {{typeof $fields}}
    + Fields: {{$fieldValues}} {{typeof $fieldValues}}
DEBUG: END 
-->
<div><label>Search</label><input type="text" name="q" {{- with .request.query.query }} value="{{- . -}}" {{- end }} placeholder="Enter your query terms here" /></div>
{{ with $highlight -}}
    {{if (eq $highlight "true") -}}
    <div><label> Show matching text?</label> <input type="radio" name="highlight" value="true" checked>Yes <input type="radio" name="highlight" value="false">No</div>
    {{- else -}}
    <div><label> Show matching text?</label> <input type="radio" name="highlight" value="true">Yes <input type="radio" name="highlight" value="false" checked>No</div>
    {{- end -}}
    </div>
{{- else -}}
    <div><label> Show matching text?</label> <input type="radio" name="highlight" value="true">Yes <input type="radio" name="highlight" value="false">No</div>
{{- end }}
{{ with $fields -}}
    <input type="hidden" name="fields" value="{{- . -}}">
{{- else -}}
    <input type="hidden" name="fields" value="*">
{{- end }}
<div>
{{ with $sortBy -}}
    {{if (eq $fields "*")}}
    <input type="hidden" name="sort" value="{{- . -}}">
    {{- else -}}
    <label>Sort by</label>
    <select name="sort">
        {{- if (or (eq $sortBy "_score") (eq $sortBy "")) -}}
        <option value="_score" selected>Relevance</option>
        {{- else -}}
        <option value="_score">Relevance</option>
        {{- end -}}
        {{- range $fieldName := $fieldValues -}}
            {{- if (eq $sortBy $fieldName) -}}
        <option value="{{- $fieldName -}}" selected>{{- $fieldName -}}</option>
            {{- else -}}
        <option value="{{- $fieldName -}}">{{- $fieldName -}}</option>
            {{- end -}}
        {{- end -}}
    </select><!-- END: select.name[sort] -->
    {{- end -}}
{{- else -}}
    <input type="hidden" name="sort" value="_score">
{{- end }}
</div>
{{ with $from -}}
    <input type="hidden" name="start" value="{{- . -}}">
{{- else -}}
    <input type="hidden" name="start" value="0">
{{- end }}
<div>
    <label>Results per page</label><select name="size">
        {{range $i := (ints 5 100 5)}}
            {{if (eq $i $size) -}}
        <option value="{{$i}}" selected>{{$i}}</option>
            {{- else -}}
        <option value="{{$i}}">{{$i}}</option>
            {{- end -}}
        {{- end}}
    </select>
</div>
    <div><input type="submit" value="Go" ></div>
</form>
</div><!-- END: searchbox -->
{{- end -}}
