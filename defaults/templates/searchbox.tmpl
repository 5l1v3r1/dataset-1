{{- define "searchbox" -}}
<form class="search-form" method="get" action="/api">
{{/* Define some useful local variables for form.*/}}
{{$qryTerms := (dotpath ".query.query" .request "")}}
{{$highlight :=  (ifDotpathExists ".highlight.style" .request "true" "false")}} 
{{$from := (int .request.from)}}
{{$size := (int .request.size)}}
{{$total := (int .total_hits)}}
{{$prev := (prevI $from $size 0 $total false)}}
{{$next := (nextI $from $size 0 $total false)}}
{{$sortBy := (join .request.sort ",")}}
{{$fields := (join (dotpath ".fields" .request "*") ",")}}

<!-- 
DEBUG: START
    + .request.from {{.request.from}} {{getType .request.from}}
    + .request.size {{.request.size}} {{getType .request.size}}
    + From: {{$from}} {{getType $from}}
    + Size: {{$size}} {{getType $size}}
    + Next: {{$next}} {{getType $next}}
    + Prev: {{$prev}} {{getType $prev}}
    + Total: {{$total}} {{getType $total}}
    + Sort By: {{$sortBy}} {{getType $sortBy}}
    + Fields: {{$fields}} {{getType $fields}}
DEBUG: END 
-->
{{with .request}}
    {{ with $highlight -}}<input type="hidden" name="highlight" value="true">{{- end}}
    {{ with .start -}}<input type="hidden" name="start" value="{{- . -}}">{{- end }}
    {{ with .fields -}}
    <input type="hidden" name="fields" value="{{- join . "," -}}">
    {{- else -}}
    <input type="hidden" name="fields" value="*">
    {{- end }}
{{else}}
    <input type="hidden" name="fields" value="*">
{{end}}
    <div><label>Search</label><input type="text" name="q" {{- with .request.query.query }} value="{{- . -}}" {{- end }} placeholder="Enter your query terms here" /></div>
<div>
     <select name="sort">
        {{with $sortBy := (join .request.sort ",") -}}
            {{if (or (eq $sortBy "-_score") (eq $sortBy ""))}}
         <option value="" selected>Relevance</option>
            {{else}}
            {{range $i := len($fields) -}}
                {{$fieldName := (index $fields "$i")}}
                {{if (neq $fieldName "*") -}}
                <option value="{{- $fieldName -}}">{{- $fieldName -}}</option>
                {{- end}}
            {{- end}}
        {{- end }}
     </select>
</div>
<div>
    <select name="size">
        {{range $i := (forInt 5 100 5)}}
            {{if (eq $i $size) -}}
        <option value="{{$i}}" selected>{{$i}}</option>
            {{- else -}}
        <option value="{{$i}}">{{$i}}</option>
            {{- end -}}
        {{- end}}
    </select>
</div>
    <div><input type="submit" value="Go" ></div>
</form>
{{- end -}}
